<!-- Search and Add Button -->
<div class="mb-4 flex justify-between items-center">
  <nz-input-group nzPrefixIcon="search" class="w-64">
    <input type="text" nz-input placeholder="Search accounts..." [(ngModel)]="searchValue" (input)="searchUsers()" />
  </nz-input-group>
  <button nz-button nzType="primary" (click)="showAddModal()">
    <span nz-icon nzType="plus"></span>
    Add Account
  </button>
</div>

<!-- Accounts Table -->
<nz-table
  #basicTable
  [nzData]="displayUsers"
  [nzLoading]="isLoading"
  [nzPageSize]="10"
  [nzShowSizeChanger]="true"
  [nzShowTotal]="totalTemplate"
  nzShowPagination
  [nzPageSizeOptions]="[10, 20, 50, 100]"
>
  <thead>
    <tr>
      <th>Username</th>
      <th>Name</th>
      <th>Email</th>
      <th>Role</th>
      <th>Age</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let user of basicTable.data">
      <td>
        <div class="flex items-center gap-2">
          <nz-avatar [nzText]="
            (user.firstName ? user.firstName[0] : '') +
            (user.lastName ? user.lastName[0] : '')
          "
          nzSize="small"></nz-avatar>
          <span>{{ user.username }}</span>
        </div>
      </td>
      <td>{{ user.lastName }}</td>
      <td>{{ user.email }}</td>
      <td>
        <span class="role-badge" [ngClass]="(user.role || '').toLowerCase()">
          {{ user.role }}
        </span>
      </td>
      <td>{{ user.age }}</td>
      <td>
        <div class="flex gap-2" *ngIf="user.role !== 'ADMIN'">
          <button nz-button nzType="link" (click)="showEditModal(user)" nzTooltipTitle="Edit">
            <span nz-icon nzType="edit" nzTheme="outline" class="text-blue-500 hover:text-blue-600"></span>
          </button>

          <button nz-button nzType="link" nzDanger nzTooltipTitle="Delete" (click)="confirmDelete(user)">
            <span nz-icon nzType="delete" nzTheme="outline"></span>
          </button>
        </div>
      </td>
    </tr>
  </tbody>
</nz-table>

<ng-template #totalTemplate let-total>Total {{ total }} items</ng-template>

<!-- Add/Edit Modal -->
<nz-modal
  [(nzVisible)]="isModalVisible"
  [nzTitle]="modalTitle"
  (nzOnCancel)="handleModalCancel()"
  [nzFooter]="modalFooter"
  [nzWidth]="600"
>
  <ng-container *nzModalContent>
    <form nz-form [formGroup]="accountForm" nzLayout="vertical">
        <!-- <nz-form-item>
          <nz-form-label nzRequired>First Name</nz-form-label>
          <nz-form-control nzErrorTip="Please input first name!">
            <input nz-input formControlName="firstName" placeholder="Enter first name" />
          </nz-form-control>
        </nz-form-item> -->

        <nz-form-item>
          <nz-form-label nzRequired>Full Name</nz-form-label>
          <nz-form-control nzErrorTip="Please input full name!">
            <input nz-input formControlName="fullName" placeholder="Enter full name" />
          </nz-form-control>
        </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired>Email</nz-form-label>
        <nz-form-control nzErrorTip="Please input a valid email!">
          <input nz-input formControlName="email" placeholder="Enter email" />
        </nz-form-control>
      </nz-form-item>

      <nz-form-item>
        <nz-form-label nzRequired>Username</nz-form-label>
        <nz-form-control nzErrorTip="Please input username!">
          <input nz-input formControlName="username" placeholder="Enter username" />
        </nz-form-control>
      </nz-form-item>

      <div class="grid grid-cols-2 gap-4">
        <nz-form-item>
          <nz-form-label nzRequired>Age</nz-form-label>
          <nz-form-control nzErrorTip="Please input a valid age!">
            <input nz-input type="number" formControlName="age" placeholder="Enter age" />
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzRequired>Role</nz-form-label>
          <nz-form-control nzErrorTip="Please select a role!">
            <nz-select formControlName="role" nzPlaceHolder="Select a role">
              <nz-option *ngFor="let role of userRoles" [nzValue]="role" [nzLabel]="role"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>
      </div>

      <ng-container *ngIf="!isEditing">
        <div class="grid grid-cols-2 gap-4">
          <nz-form-item>
            <nz-form-label nzRequired>Password</nz-form-label>
            <nz-form-control nzErrorTip="Please input password!">
              <input nz-input type="password" formControlName="password" placeholder="Enter password" />
            </nz-form-control>
          </nz-form-item>

          <nz-form-item>
            <nz-form-label nzRequired>Confirm Password</nz-form-label>
            <nz-form-control nzErrorTip="Please confirm your password!">
              <input nz-input type="password" formControlName="confirmPassword" placeholder="Confirm password" />
            </nz-form-control>
          </nz-form-item>
        </div>
      </ng-container>
    </form>
  </ng-container>

  <ng-template #modalFooter>
    <button nz-button nzType="default" (click)="handleModalCancel()">Cancel</button>
    <button nz-button nzType="primary" [nzLoading]="submitting" (click)="handleModalOk()">Save</button>
  </ng-template>
</nz-modal>
